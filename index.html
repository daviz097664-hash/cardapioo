<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gar√ßom - Site A</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { background-color: #000; color: #fff; font-family: sans-serif; padding: 20px; padding-bottom: 150px; }
        header { text-align: center; margin-bottom: 20px; border-bottom: 2px solid #ffc107; padding-bottom: 10px; }
        header h1 { color: #ffc107; font-size: 1.5rem; text-transform: uppercase; }
        .secao-identificacao input { width: 100%; padding: 15px; background: #222; border: 1px solid #ffc107; color: #fff; border-radius: 8px; margin-bottom: 20px; font-size: 1rem; }
        h2 { color: #ffc107; margin: 25px 0 10px 0; border-left: 4px solid #ffc107; padding-left: 10px; font-size: 1.2rem; text-transform: uppercase; }
        .item { background: #111; border: 1px solid #333; border-radius: 10px; padding: 15px; margin-bottom: 15px; }
        .info h3 { color: #fff; margin-bottom: 2px; font-size: 1.1rem; }
        .info p { color: #aaa; font-size: 0.85rem; margin-bottom: 10px; line-height: 1.2; }
        .input-obs { background: #1a1a1a; border: 1px solid #444; color: #ffc107; padding: 10px; border-radius: 5px; width: 100%; font-size: 0.9rem; margin-bottom: 12px; }
        .rodape-item { display: flex; justify-content: space-between; align-items: center; }
        .preco { color: #4caf50; font-weight: bold; font-size: 1.1rem; }
        .acoes { display: flex; align-items: center; gap: 15px; }
        .acoes button { background: #ffc107; border: none; width: 40px; height: 40px; font-size: 1.4rem; font-weight: bold; border-radius: 8px; cursor: pointer; }
        .quantidade { font-size: 1.4rem; font-weight: bold; min-width: 25px; text-align: center; }
        
        .card-consumo { background: #111; border: 1px solid #333; border-radius: 10px; padding: 15px; margin-bottom: 15px; border-left: 8px solid #ffc107; }
        .lista-itens { color: #eee; font-size: 0.95rem; line-height: 1.4; white-space: pre-wrap; margin-bottom: 15px; background: #1a1a1a; padding: 10px; border-radius: 5px; }
        .total-consumo { color: #4caf50; font-weight: bold; font-size: 1.2rem; text-align: right; margin-bottom: 10px; }
        .btn-acao { border: none; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 5px; width: 100%; }
        .btn-edit { background: #2196f3; color: white; margin-bottom: 5px; }
        .btn-fechar { background: #b02a37; color: white; margin-top: 10px; }
        
        .rodape-fixo { position: fixed; bottom: 0; left: 0; width: 100%; background: #111; padding: 20px; border-top: 2px solid #ffc107; display: flex; justify-content: space-between; align-items: center; z-index: 100; }
        #total { font-size: 1.3rem; font-weight: bold; color: #ffc107; }
        #enviar { background: #4caf50; color: #fff; border: none; padding: 15px 25px; border-radius: 8px; font-weight: bold; }

        .painel-caixa { background: #1a1a1a; border: 2px solid #4caf50; padding: 20px; border-radius: 15px; margin-top: 50px; text-align: center; }
        .venda-valor { font-size: 2.2rem; color: #4caf50; font-weight: bold; margin: 10px 0; }
        .btn-zerar { background: #444; color: #fff; border: none; padding: 10px; border-radius: 5px; cursor: pointer; font-size: 0.8rem; margin-top: 10px; }

        #modal-relatorio { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); z-index:200; overflow-y:auto; padding:20px; }
        .relatorio-corpo { background:#111; border:1px solid #ffc107; border-radius:15px; padding:20px; max-width:600px; margin:auto; }
    </style>
</head>
<body>

<header><h1>Gar√ßom - Site A</h1></header>
<div id="aviso-edicao" style="display:none; background:#d32f2f; text-align:center; padding:10px; font-weight:bold; color:white;">MODO ADICIONAR ITENS</div>
<div class="secao-identificacao">
    <input type="hidden" id="pedido-id-edicao">
    <input type="text" id="nome-cliente" placeholder="NOME DO CLIENTE OU MESA">
</div>

<main class="cardapio">
    <h2>üçî Hamb√∫rgueres</h2>
    <div class="item"><div class="info"><h3>X-burguer</h3><p>Hamb√∫rguer, presunto, mussarela, ketchup e maionese</p><input type="text" id="obs-X-burguer" class="input-obs" placeholder="Obs..."></div><div class="rodape-item"><div class="preco">R$ 16,00</div><div class="acoes"><button onclick="removerItem('X-burguer')">-</button><span id="qtd-X-burguer" class="quantidade">0</span><button onclick="addItem('X-burguer', 16)">+</button></div></div></div>
    <div class="item"><div class="info"><h3>X-Salada</h3><p>Hamb√∫rguer, presunto, mussarela, salada e maionese</p><input type="text" id="obs-X-Salada" class="input-obs" placeholder="Obs..."></div><div class="rodape-item"><div class="preco">R$ 18,00</div><div class="acoes"><button onclick="removerItem('X-Salada')">-</button><span id="qtd-X-Salada" class="quantidade">0</span><button onclick="addItem('X-Salada', 18)">+</button></div></div></div>
    <div class="item"><div class="info"><h3>X-EGG</h3><input type="text" id="obs-X-EGG" class="input-obs" placeholder="Obs..."></div><div class="rodape-item"><div class="preco">R$ 20,00</div><div class="acoes"><button onclick="removerItem('X-EGG')">-</button><span id="qtd-X-EGG" class="quantidade">0</span><button onclick="addItem('X-EGG', 20)">+</button></div></div></div>
    <div class="item"><div class="info"><h3>X-Bacon</h3><input type="text" id="obs-X-Bacon" class="input-obs" placeholder="Obs..."></div><div class="rodape-item"><div class="preco">R$ 25,00</div><div class="acoes"><button onclick="removerItem('X-Bacon')">-</button><span id="qtd-X-Bacon" class="quantidade">0</span><button onclick="addItem('X-Bacon', 25)">+</button></div></div></div>
    <div class="item"><div class="info"><h3>X-Tudo</h3><input type="text" id="obs-X-Tudo" class="input-obs" placeholder="Obs..."></div><div class="rodape-item"><div class="preco">R$ 28,00</div><div class="acoes"><button onclick="removerItem('X-Tudo')">-</button><span id="qtd-X-Tudo" class="quantidade">0</span><button onclick="addItem('X-Tudo', 28)">+</button></div></div></div>

    <h2>ü•ñ No P√£o Franc√™s</h2>
    <div class="item"><div class="info"><h3>Misto Quente</h3><input type="text" id="obs-Misto-Quente" class="input-obs" placeholder="Obs..."></div><div class="rodape-item"><div class="preco">R$ 10,00</div><div class="acoes"><button onclick="removerItem('Misto-Quente')">-</button><span id="qtd-Misto-Quente" class="quantidade">0</span><button onclick="addItem('Misto-Quente', 10)">+</button></div></div></div>
    <div class="item"><div class="info"><h3>Misto c/ Ovo</h3><input type="text" id="obs-Misto-Ovo" class="input-obs" placeholder="Obs..."></div><div class="rodape-item"><div class="preco">R$ 12,00</div><div class="acoes"><button onclick="removerItem('Misto-Ovo')">-</button><span id="qtd-Misto-Ovo" class="quantidade">0</span><button onclick="addItem('Misto-Ovo', 12)">+</button></div></div></div>
    <div class="item"><div class="info"><h3>X-Calabresa</h3><input type="text" id="obs-X-Calabresa" class="input-obs" placeholder="Obs..."></div><div class="rodape-item"><div class="preco">R$ 15,00</div><div class="acoes"><button onclick="removerItem('X-Calabresa')">-</button><span id="qtd-X-Calabresa" class="quantidade">0</span><button onclick="addItem('X-Calabresa', 15)">+</button></div></div></div>
    <div class="item"><div class="info"><h3>Contra-fil√©</h3><input type="text" id="obs-Contra-file" class="input-obs" placeholder="Obs..."></div><div class="rodape-item"><div class="preco">R$ 20,00</div><div class="acoes"><button onclick="removerItem('Contra-file')">-</button><span id="qtd-Contra-file" class="quantidade">0</span><button onclick="addItem('Contra-file', 20)">+</button></div></div></div>

    <h2>ü•§ Bebidas</h2>
    <div class="item"><div class="info"><h3>Coca Lata</h3></div><div class="rodape-item"><div class="preco">R$ 7,00</div><div class="acoes"><button onclick="removerItem('Coca-Lata')">-</button><span id="qtd-Coca-Lata" class="quantidade">0</span><button onclick="addItem('Coca-Lata', 7)">+</button></div></div></div>
    <div class="item"><div class="info"><h3>Coca 600ml</h3></div><div class="rodape-item"><div class="preco">R$ 10,00</div><div class="acoes"><button onclick="removerItem('Coca-600')">-</button><span id="qtd-Coca-600" class="quantidade">0</span><button onclick="addItem('Coca-600', 10)">+</button></div></div></div>
    <div class="item"><div class="info"><h3>Coca 1 Litro</h3></div><div class="rodape-item"><div class="preco">R$ 12,00</div><div class="acoes"><button onclick="removerItem('Coca-1L')">-</button><span id="qtd-Coca-1L" class="quantidade">0</span><button onclick="addItem('Coca-1L', 12)">+</button></div></div></div>
    <div class="item"><div class="info"><h3>Guaran√° / Fanta Lata</h3></div><div class="rodape-item"><div class="preco">R$ 7,00</div><div class="acoes"><button onclick="removerItem('Guarana-Fanta')">-</button><span id="qtd-Guarana-Fanta" class="quantidade">0</span><button onclick="addItem('Guarana-Fanta', 7)">+</button></div></div></div>
    <div class="item"><div class="info"><h3>Suco 500ml</h3><input type="text" id="obs-Suco" class="input-obs" placeholder="Sabor..."></div><div class="rodape-item"><div class="preco">R$ 10,00</div><div class="acoes"><button onclick="removerItem('Suco')">-</button><span id="qtd-Suco" class="quantidade">0</span><button onclick="addItem('Suco', 10)">+</button></div></div></div>

    <h2>üíß √Åguas</h2>
    <div class="item"><div class="info"><h3>√Ågua sem G√°s</h3></div><div class="rodape-item"><div class="preco">R$ 3,00</div><div class="acoes"><button onclick="removerItem('Agua-sem')">-</button><span id="qtd-Agua-sem" class="quantidade">0</span><button onclick="addItem('Agua-sem', 3)">+</button></div></div></div>
    <div class="item"><div class="info"><h3>√Ågua com G√°s</h3></div><div class="rodape-item"><div class="preco">R$ 4,00</div><div class="acoes"><button onclick="removerItem('Agua-com')">-</button><span id="qtd-Agua-com" class="quantidade">0</span><button onclick="addItem('Agua-com', 4)">+</button></div></div></div>

    <h2>üç∫ Cervejas</h2>
    <div class="item"><div class="info"><h3>Cerveja Heineken</h3></div><div class="rodape-item"><div class="preco">R$ 9,00</div><div class="acoes"><button onclick="removerItem('Heineken')">-</button><span id="qtd-Heineken" class="quantidade">0</span><button onclick="addItem('Heineken', 9)">+</button></div></div></div>
    <div class="item"><div class="info"><h3>Cerveja Brahma</h3></div><div class="rodape-item"><div class="preco">R$ 6,00</div><div class="acoes"><button onclick="removerItem('Brahma')">-</button><span id="qtd-Brahma" class="quantidade">0</span><button onclick="addItem('Brahma', 6)">+</button></div></div></div>
    <div class="item"><div class="info"><h3>Cerveja Skol</h3></div><div class="rodape-item"><div class="preco">R$ 6,00</div><div class="acoes"><button onclick="removerItem('Skol')">-</button><span id="qtd-Skol" class="quantidade">0</span><button onclick="addItem('Skol', 6)">+</button></div></div></div>

    <h2>‚ûï Adicionais</h2>
    <div class="item"><div class="info"><h3>Hamb√∫rguer Extra</h3></div><div class="rodape-item"><div class="preco">R$ 5,00</div><div class="acoes"><button onclick="removerItem('Hamb-Extra')">-</button><span id="qtd-Hamb-Extra" class="quantidade">0</span><button onclick="addItem('Hamb-Extra', 5)">+</button></div></div></div>
    <div class="item"><div class="info"><h3>Bacon Extra</h3></div><div class="rodape-item"><div class="preco">R$ 5,00</div><div class="acoes"><button onclick="removerItem('Bacon-Extra')">-</button><span id="qtd-Bacon-Extra" class="quantidade">0</span><button onclick="addItem('Bacon-Extra', 5)">+</button></div></div></div>
    <div class="item"><div class="info"><h3>Ovo Extra</h3></div><div class="rodape-item"><div class="preco">R$ 3,00</div><div class="acoes"><button onclick="removerItem('Ovo-Extra')">-</button><span id="qtd-Ovo-Extra" class="quantidade">0</span><button onclick="addItem('Ovo-Extra', 3)">+</button></div></div></div>

    <hr style="border: 1px dashed #ffc107; margin: 40px 0;">
    <h2>üìë PEDIDOS EM CONSUMO</h2>
    <div id="lista-consumo"></div>

    <div class="painel-caixa">
        <h3>üí∞ TOTAL VENDIDO NO DIA</h3>
        <div class="venda-valor" id="faturamento-dia">R$ 0,00</div>
        <button class="btn-zerar" onclick="window.abrirRelatorio()">REINICIAR CAIXA DO DIA</button>
    </div>
</main>

<div id="modal-relatorio">
    <div class="relatorio-corpo">
        <h2 style="text-align:center; color:#ffc107">FECHAMENTO DE CAIXA</h2>
        <div id="conteudo-relatorio" style="margin:20px 0"></div>
        <button class="btn-acao" style="background:#4caf50; color:#fff" onclick="window.confirmarZerarTudo()">CONFIRMAR E LIMPAR DIA</button>
        <button class="btn-acao" style="background:#444; color:#fff" onclick="document.getElementById('modal-relatorio').style.display='none'">CANCELAR</button>
    </div>
</div>

<footer class="rodape-fixo">
    <div id="total">Total: R$ 0,00</div>
    <button id="enviar" onclick="finalizarPedido()">LAN√áAR PEDIDO</button>
</footer>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, push, onValue, remove, update, set, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyA0dHn3SXaO1Vc5cnovA7rddJN0WNrpi4k",
        authDomain: "cardapio-restaurante-df665.firebaseapp.com",
        databaseURL: "https://cardapio-restaurante-df665-default-rtdb.firebaseio.com/",
        projectId: "cardapio-restaurante-df665",
        storageBucket: "cardapio-restaurante-df665.firebasestorage.app",
        messagingSenderId: "205272470692",
        appId: "1:205272470692:web:1cfc7c7d084887a3fe4231"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    let carrinhoAtual = {}; 
    let itensConsumidos = {}; 

    window.addItem = (n, p) => { 
        if(!carrinhoAtual[n]) carrinhoAtual[n] = {qtd:0, preco:p}; 
        carrinhoAtual[n].qtd++; 
        atualizarUI(); 
    };

    window.removerItem = (n) => { 
        if(carrinhoAtual[n] && carrinhoAtual[n].qtd > 0){ 
            carrinhoAtual[n].qtd--; 
            if(carrinhoAtual[n].qtd === 0) delete carrinhoAtual[n]; 
        } 
        atualizarUI(); 
    };

    function atualizarUI() {
        let subtotal = 0;
        document.querySelectorAll('.quantidade').forEach(span => {
            const id = span.id.replace('qtd-', '');
            span.innerText = carrinhoAtual[id] ? carrinhoAtual[id].qtd : 0;
        });
        for(let id in carrinhoAtual) subtotal += (carrinhoAtual[id].qtd * carrinhoAtual[id].preco);
        for(let id in itensConsumidos) subtotal += (itensConsumidos[id].qtd * itensConsumidos[id].preco);
        document.getElementById('total').innerText = `Total: R$ ${subtotal.toFixed(2)}`;
    }

    window.finalizarPedido = function() {
        const idEd = document.getElementById('pedido-id-edicao').value;
        const cli = document.getElementById('nome-cliente').value;
        if(!cli) return alert("Informe o nome do cliente!");

        let dadosDetaFinal = { ...itensConsumidos };
        for(let id in carrinhoAtual) {
            const obs = document.getElementById(`obs-${id}`)?.value || "";
            const chaveUnica = idEd ? `${id}_${Date.now()}` : id;
            dadosDetaFinal[chaveUnica] = { nome: id.replace(/-/g, ' '), qtd: carrinhoAtual[id].qtd, preco: carrinhoAtual[id].preco, obs: obs };
        }

        let textoTotal = "";
        let valorFinal = 0;
        for(let k in dadosDetaFinal) {
            const it = dadosDetaFinal[k];
            textoTotal += `${it.qtd}x ${it.nome}${it.obs ? ' ('+it.obs+')' : ''}\n`;
            valorFinal += (it.qtd * it.preco);
        }

        const payload = { cliente: cli, itens: textoTotal, itensDeta: dadosDetaFinal, total: valorFinal.toFixed(2) };
        if(idEd) update(ref(db, `pedidos/${idEd}`), payload).then(() => location.reload());
        else push(ref(db, 'pedidos'), payload).then(() => location.reload());
    };

    onValue(ref(db, 'pedidos'), (snapshot) => {
        const pedidos = snapshot.val();
        const container = document.getElementById('lista-consumo');
        container.innerHTML = ""; 
        if (!pedidos) return;
        Object.keys(pedidos).forEach(id => {
            const p = pedidos[id];
            const card = document.createElement('div');
            card.className = 'card-consumo';
            card.innerHTML = `
                <strong>üë§ ${p.cliente}</strong>
                <div class="lista-itens">${p.itens}</div>
                <div class="total-consumo">R$ ${p.total}</div>
                <button class="btn-edit btn-acao" onclick="window.retomar('${id}', '${p.cliente}', ${JSON.stringify(p.itensDeta).replace(/"/g, '&quot;')})">ADICIONAR MAIS ‚ûï</button>
                <button class="btn-fechar btn-acao" onclick="window.receberERegistrar('${id}', ${p.total}, '${p.cliente}', '${p.itens.replace(/\n/g, ', ')}')">FECHAR CONTA üèÅ</button>
            `;
            container.appendChild(card);
        });
    });

    onValue(ref(db, 'historico_vendas/faturamento_total'), (snap) => {
        document.getElementById('faturamento-dia').innerText = `R$ ${parseFloat(snap.val() || 0).toFixed(2)}`;
    });

    window.receberERegistrar = async (id, valor, cliente, itensTexto) => {
        // Sequ√™ncia: D√©bito, Cr√©dito, Pix, Dinheiro, VR
        const msg = `CLIENTE: ${cliente}\nVALOR: R$ ${valor.toFixed(2)}\n\n1. D√©bito\n2. Cr√©dito\n3. Pix\n4. Dinheiro\n5. VR`;
        const op = prompt(msg);
        const formas = {"1":"D√©bito","2":"Cr√©dito","3":"Pix","4":"Dinheiro","5":"VR"};

        if (formas[op]) {
            const fRef = ref(db, 'historico_vendas/faturamento_total');
            const snap = await get(fRef);
            
            // Salva registro detalhado para o relat√≥rio
            await push(ref(db, 'historico_vendas/vendas_dia'), {
                cliente: cliente,
                valor: valor,
                forma: formas[op],
                resumo: itensTexto.substring(0, 35) + "..."
            });

            await set(fRef, parseFloat(snap.val() || 0) + parseFloat(valor));
            await remove(ref(db, `pedidos/${id}`));
            alert("Venda registrada!");
        }
    };

    window.abrirRelatorio = async () => {
        const snap = await get(ref(db, 'historico_vendas/vendas_dia'));
        const vendas = snap.val() || {};
        let totalGeral = 0;
        let pgtos = { "D√©bito":0, "Cr√©dito":0, "Pix":0, "Dinheiro":0, "VR":0 };
        let listaHtml = "<h3>Vendas Individuais:</h3><br>";

        Object.values(vendas).forEach(v => {
            const val = parseFloat(v.valor);
            pgtos[v.forma] += val;
            totalGeral += val;
            listaHtml += `<div style='font-size:0.85rem; border-bottom:1px solid #333; padding:8px 0'>
                <b>${v.cliente}</b> [${v.forma}] - <span style='color:#4caf50'>R$ ${val.toFixed(2)}</span><br>
                <i style='color:#888'>${v.resumo}</i>
            </div>`;
        });

        let resumoHtml = "<h3>Totais por Categoria:</h3><br>";
        for(let f in pgtos) { resumoHtml += `<p>${f}: <b>R$ ${pgtos[f].toFixed(2)}</b></p>`; }
        resumoHtml += `<br><h2 style='color:#4caf50'>TOTAL GERAL: R$ ${totalGeral.toFixed(2)}</h2><hr style='margin:15px 0; border-color:#444'>`;

        document.getElementById('conteudo-relatorio').innerHTML = resumoHtml + listaHtml;
        document.getElementById('modal-relatorio').style.display = 'flex';
    };

    window.confirmarZerarTudo = () => {
        if(confirm("ATEN√á√ÉO: Isso apagar√° todas as vendas registradas e zerar√° o caixa. Deseja continuar?")) {
            set(ref(db, 'historico_vendas'), { faturamento_total: 0, vendas_dia: null }).then(() => location.reload());
        }
    };

    window.retomar = (id, cli, itensAntigos) => {
        document.getElementById('pedido-id-edicao').value = id;
        document.getElementById('nome-cliente').value = cli;
        document.getElementById('aviso-edicao').style.display = "block";
        itensConsumidos = itensAntigos;
        carrinhoAtual = {}; 
        atualizarUI();
        window.scrollTo(0,0);
        document.getElementById('enviar').innerText = "ATUALIZAR CONSUMO";
    };
</script>
</body>
</html>

